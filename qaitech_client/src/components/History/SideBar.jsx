import { useContext, useEffect, useState } from "react";
import { useParams } from "react-router-dom";
import { MacScrollbar } from "mac-scrollbar";
import "mac-scrollbar/dist/mac-scrollbar.css";
import toast from "react-hot-toast";

import Accordion from "../../components/History/Accordion";
import CustomLoader from "../../shared/ui/CustomLoader";

import { Button } from "../../shared/ui/Button";
import { Input } from "../../shared/ui/Input";

import { ModalContext } from "../Modals/ModalHandlerWrap";
import { PagesContext } from "../../layouts/PagesContex";

import { getPagesForWorkspace } from "../../server/page/getPagesForWorkspace";
import { getReportsForHistory } from "../../server/history/getReportsForHistory";

const SideBar = () => {
  const { workSpaceId } = useParams();

  const { createPageModal, setCreatePageModal } = useContext(ModalContext);
  const { data, setData } = useContext(PagesContext);

  const [loading, setLoading] = useState(false);

  const getData = async () => {
    // console.log("fetching");
    if (loading) return;
    setLoading(true);
    const res = await getReportsForHistory(workSpaceId);

    if (!!res?.error) {
      toast.error(res?.error);
      return;
    }

    setData(res?.reports);
    setLoading(false);
  };

  useEffect(() => {
    getData("");
  }, [getPagesForWorkspace, createPageModal, workSpaceId]);

  return (
    <>
      {/* search */}
      <div className="h-full border-b-[1px] justify-end border-b-primary px-[12px] py-[8px] overflow-hidden flex flex-row gap-[12px] items-center">
        {/* <div className="flex flex-row overflow-visible gap-[8px] items-center w-full">
          <Input
            placeholder="Search"
            value={input}
            onChange={setInput}
            style="min-w-[61px] w-full"
            errorTailwind="hidden"
          />
        </div> */}

        <Button text="import" onClick={() => setCreatePageModal(true)} />
      </div>
      {/* search */}

      {/* accordions */}
      <MacScrollbar
        skin="light"
        className="overflow-y-auto w-full h-full flex flex-col"
        trackStyle={() => ({
          backgroundColor: "transparent",
          margin: 3,
          border: "none",
        })}
        thumbStyle={() => ({
          backgroundColor: "#515677",
        })}
      >
        {/* {data?.map((i, key) => (
          DANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOHDANIL LOH DANIL LOH DANIL LOH DANIL LOH
        ))} */}
        {!data || !!loading ? (
          <div className="w-full flex justify-center mt-[12px]">
            <CustomLoader
              size={22}
              color="rgba(153, 222, 175, 1)"
              secondaryColor="rgba(153, 222, 175, 0.6)"
            />
          </div>
        ) : data?.length === 0 ? (
          <div className="flex flex-col w-full gap-[5px] mt-[12px]">
            <>
              <p className="text-center select-none text-[13px] font-medium leading-[22px] tracking-[-1%] text-accent-dark_purple">
                Запускайте тесты
              </p>
              <p className="text-center select-none text-[13px] leading-[16px] whitespace-pre-wrap tracking-[-1%] text-accent-dark_purple">
                чтобы формировать отчёты
              </p>
            </>
          </div>
        ) : (
          <>
            {data?.map((item, key) => (
              <Accordion key={key} item={item} />
            ))}
          </>
        )}
      </MacScrollbar>
      {/* accordions */}
    </>
  );
};

export default SideBar;
